<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESL Placement Test</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(to right, #a38758bd, #207f97); color: #333; margin: 0; padding: 0; }
    #container { max-width: 800px; margin: 40px auto; background: #fff; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); overflow: hidden; }
    #info, #quiz-box, #result { padding: 30px; text-align: center; }
    h2 { margin-bottom: 20px; }
    .option { display: block; background: #f0f0f0; padding: 12px; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: 0.3s; }
    .option:hover { background: #e0e0e0; }
    .correct { background: #4CAF50; color: #fff; }
    .wrong { background: #f44336; color: #fff; }
    #progress-container { width: 90%; background: #ddd; height: 20px; border-radius: 10px; margin: 20px auto; }
    #progress-bar { height: 100%; width: 0%; background: #4CAF50; border-radius: 10px; transition: width 0.3s; }
    button { padding: 12px 25px; font-size: 16px; cursor: pointer; border-radius: 8px; border: none; background: #2193b0; color: white; transition: 0.3s; margin-top: 10px; }
    button:hover { background: #6dd5ed; color: #000; }
  </style>
</head>
<body>
  <div id="container">
    <div id="info">
      <h2>Welcome to the ESL Placement Test</h2>
      <p>
        You will be presented with 100 multiple-choice questions to determine your English level (A1â€“C2).<br>
        You can now choose to answer a question or skip it. Skipping moves you forward, but unanswered questions still count toward progress and affect your final score.<br>
        Correct answers turn green, incorrect red. Progress is shown below.<br>
        Click "Start Quiz" when you're ready.
      </p>
      <form id="userForm">
        <label for="username">Name:</label><br>
        <input type="text" id="username" name="username" required><br><br>
        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email" required><br><br>
      </form>
      <button onclick="validateUser()">Start Quiz</button>
    </div>

    <div id="quiz-box" style="display:none;">
      <div id="question-container"></div>
      <button id="skipBtn" onclick="skipQuestion()">Skip Question</button>
      <div id="progress-container"><div id="progress-bar"></div></div>
    </div>

    <div id="result" style="display:none;"></div>
  </div>

  <script>
    // <-- Replace with your Apps Script Web App URL -->
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbzqDBSf31qxX5wgvNY6QA5NzOLpIChFUVLnX-n3K8aRM3N9SFg9RaZw7IPdbugcchYK/exec";

    function validateUser() {
      const name = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      if (!name || !email) {
        alert("Please enter both your name and email to start the quiz.");
        return;
      }
      localStorage.setItem("quizUserName", name);
      localStorage.setItem("quizUserEmail", email);
      startQuiz();
    }

    const quizData = [
      {question: "Whatâ€™s your name?", options: ["I name John","My name John","My name is John","Iâ€™m name John","Name is John"], correct:2},
      {question: "I ___ a student.", options: ["is","are","am","be","being"], correct:2},
      // ... (omitted for brevity; include all your questions from your original code)
      {question: "The manager demanded that the report ___ immediately.", options:["be submitted","is submitted","submitted","submits","was submitted"], correct:0},
    ];

    let currentQuestion = 0;
    let score = 0;

    const infoBox = document.getElementById("info");
    const quizBox = document.getElementById("quiz-box");
    const questionContainer = document.getElementById("question-container");
    const progressBar = document.getElementById("progress-bar");
    const resultBox = document.getElementById("result");

    function startQuiz() {
      infoBox.style.display = "none";
      quizBox.style.display = "block";
      loadQuestion();
    }

    function loadQuestion() {
      if (currentQuestion >= quizData.length) {
        quizBox.style.display = "none";
        resultBox.style.display = "block";
        showLevel();
        return;
      }
      const q = quizData[currentQuestion];
      questionContainer.innerHTML = `
        <div class="question">${currentQuestion + 1}. ${q.question}</div>
        ${q.options.map((opt, i) =>
          `<div class="option" onclick="checkAnswer(${i})">${opt}</div>`
        ).join("")}
      `;
    }

    function checkAnswer(selected) {
      const q = quizData[currentQuestion];
      const optionsEls = document.querySelectorAll(".option");
      optionsEls.forEach((btn, idx) => {
        btn.style.pointerEvents = "none";
        if (idx === q.correct) btn.classList.add("correct");
        else if (idx === selected) btn.classList.add("wrong");
      });
      if (selected === q.correct) score++;
      currentQuestion++;
      progressBar.style.width = `${(currentQuestion / quizData.length) * 100}%`;
      setTimeout(loadQuestion, 800);
    }

    function skipQuestion() {
      currentQuestion++;
      progressBar.style.width = `${(currentQuestion / quizData.length) * 100}%`;
      loadQuestion();
    }

    function showLevel() {
      const percent = (score / quizData.length) * 100;
      let level;
      if (percent <= 20) level = "A1 (Beginner)";
      else if (percent <= 40) level = "A2 (Elementary)";
      else if (percent <= 60) level = "B1 (Intermediate)";
      else if (percent <= 80) level = "B2 (Upper-Intermediate)";
      else if (percent <= 90) level = "C1 (Advanced)";
      else level = "C2 (Proficient)";

      const userName = localStorage.getItem("quizUserName");
      const userEmail = localStorage.getItem("quizUserEmail");

      resultBox.innerHTML = `
        ðŸŽ‰ Your English level is: <strong>${level}</strong> (${score}/${quizData.length})<br><br>
        ðŸ‘¤ Name: <strong>${userName}</strong><br>
        ðŸ“§ Email: <strong>${userEmail}</strong>
      `;

      const payload = {
        name: userName,
        email: userEmail,
        score: score,
        level: level,
        percent: Math.round(percent)
      };

      fetch(ENDPOINT_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      })
      .then(res => res.text())
      .then(text => console.log("Sheet response:", text))
      .catch(err => console.error("Submit error:", err));
    }
  </script>
</body>
</html>
